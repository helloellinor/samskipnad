{{define "content"}}
<style>
    /* Edgy minimalist klippekort design */
    .klipp-header {
        background: linear-gradient(45deg, #000, #1a1a1a);
        border: 1px solid #333;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
    }
    
    .klipp-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        animation: shine 3s infinite;
    }
    
    @keyframes shine {
        0% { left: -100%; }
        100% { left: 100%; }
    }
    
    .balance-display {
        background: #0a0a0a;
        border: 1px solid #333;
        border-radius: 4px;
        padding: 1rem;
        margin-bottom: 2rem;
    }
    
    .balance-item {
        padding: 0.5rem;
        border-bottom: 1px solid #222;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .balance-item:last-child {
        border-bottom: none;
    }
    
    .category-tabs {
        display: flex;
        border-bottom: 1px solid #333;
        margin-bottom: 2rem;
        overflow-x: auto;
    }
    
    .category-tab {
        background: transparent;
        border: none;
        color: #666;
        padding: 1rem 2rem;
        cursor: pointer;
        transition: all 0.2s;
        font-family: 'Space Mono', monospace;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-size: 0.9rem;
        border-bottom: 2px solid transparent;
        white-space: nowrap;
    }
    
    .category-tab:hover {
        color: #fff;
        background: #111;
    }
    
    .category-tab.active {
        color: #ff6b35;
        border-bottom-color: #ff6b35;
        background: #0a0a0a;
    }
    
    .category-content {
        min-height: 400px;
        background: #0a0a0a;
        border: 1px solid #333;
        border-radius: 4px;
    }
    
    .package-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1rem;
        padding: 1rem;
    }
    
    .package-card {
        background: #111;
        border: 1px solid #333;
        border-radius: 4px;
        padding: 1.5rem;
        transition: all 0.3s;
        position: relative;
        cursor: pointer;
    }
    
    .package-card:hover {
        border-color: #ff6b35;
        box-shadow: 0 0 20px rgba(255,107,53,0.2);
        transform: translateY(-2px);
    }
    
    .package-card.best-deal {
        border-color: #00ff41;
        background: #001a06;
    }
    
    .package-card.best-deal::before {
        content: 'BEST';
        position: absolute;
        top: -1px;
        right: -1px;
        background: #00ff41;
        color: #000;
        padding: 0.25rem 0.5rem;
        font-size: 0.7rem;
        font-weight: bold;
        letter-spacing: 1px;
    }
    
    .package-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #333;
    }
    
    .package-klipp {
        font-size: 2rem;
        font-weight: bold;
        color: #fff;
    }
    
    .package-price {
        text-align: right;
    }
    
    .total-price {
        font-size: 1.5rem;
        color: #ff6b35;
        font-weight: bold;
    }
    
    .per-klipp {
        font-size: 0.9rem;
        color: #666;
    }
    
    .savings {
        background: #001a06;
        color: #00ff41;
        padding: 0.25rem 0.5rem;
        border-radius: 2px;
        font-size: 0.8rem;
        margin-top: 0.5rem;
        display: inline-block;
    }
    
    .purchase-btn {
        width: 100%;
        background: transparent;
        border: 1px solid #ff6b35;
        color: #ff6b35;
        padding: 0.75rem;
        font-family: 'Space Mono', monospace;
        text-transform: uppercase;
        letter-spacing: 1px;
        cursor: pointer;
        transition: all 0.2s;
        margin-top: 1rem;
    }
    
    .purchase-btn:hover {
        background: #ff6b35;
        color: #000;
    }
    
    .purchase-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .loading {
        opacity: 0.6;
        pointer-events: none;
    }
    
    .error-message {
        background: #1a0606;
        border: 1px solid #ff073a;
        color: #ff073a;
        padding: 1rem;
        margin: 1rem 0;
        border-radius: 4px;
    }
    
    .success-message {
        background: #061a06;
        border: 1px solid #00ff41;
        color: #00ff41;
        padding: 1rem;
        margin: 1rem 0;
        border-radius: 4px;
    }
    
    @media (max-width: 768px) {
        .category-tabs {
            flex-wrap: wrap;
        }
        
        .category-tab {
            flex: 1;
            min-width: 120px;
        }
        
        .package-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<!-- HTMX Klippekort Interface -->
<div class="klipp-header p-4">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1 class="h3 mb-1 text-white">KLIPPEKORT</h1>
            <p class="mb-0 text-muted">1 KLIPP = 1 SESSION · NO EXPIRY</p>
        </div>
        <div class="text-end">
            <button class="btn btn-outline-light btn-sm" 
                    hx-get="/api/klippekort/balance"
                    hx-target="#balance-display"
                    hx-indicator="#balance-loading">
                <span id="balance-loading" class="htmx-indicator">⟳</span>
                REFRESH BALANCE
            </button>
        </div>
    </div>
</div>

<!-- Balance Display -->
<div id="balance-display" class="balance-display"
     hx-get="/api/klippekort/balance"
     hx-trigger="load">
    <div class="text-center p-4">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
</div>

<!-- Category Navigation -->
<div class="category-tabs">
    {{range $index, $category := .Community.Pricing.Klippekort.Categories}}
    <button class="category-tab {{if eq $index 0}}active{{end}}"
            hx-get="/api/klippekort/category?category={{$category.ID}}"
            hx-target="#category-content"
            hx-indicator="#category-loading"
            onclick="setActiveTab(this)">
        {{$category.Name}}
    </button>
    {{end}}
</div>

<!-- Category Content -->
<div id="category-content" class="category-content">
    <div class="text-center p-5">
        <div id="category-loading" class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
</div>

<!-- Purchase Result -->
<div id="purchase-result"></div>

<script>
function setActiveTab(button) {
    // Remove active class from all tabs
    document.querySelectorAll('.category-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Add active class to clicked tab
    button.classList.add('active');
}

// Load first category on page load
document.addEventListener('DOMContentLoaded', function() {
    const firstCategory = '{{if .Community.Pricing.Klippekort.Categories}}{{(index .Community.Pricing.Klippekort.Categories 0).ID}}{{end}}';
    if (firstCategory) {
        htmx.ajax('GET', '/api/klippekort/category?category=' + firstCategory, '#category-content');
    }
});

// Auto-refresh balance after purchase
document.body.addEventListener('htmx:afterRequest', function(evt) {
    if (evt.detail.pathInfo.requestPath.includes('/klippekort/purchase')) {
        htmx.ajax('GET', '/api/klippekort/balance', '#balance-display');
    }
});
</script>
{{end}}