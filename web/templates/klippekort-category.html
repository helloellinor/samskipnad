{{define "klippekort-category"}}
<div class="p-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h5 class="text-white mb-1">{{.Category.Name}}</h5>
            <small class="text-muted">{{.Category.Description}}</small>
        </div>
        <div class="text-end">
            <span class="text-muted small">Current balance:</span>
            <div class="h6 text-primary mb-0">{{.Balance}} klipp</div>
        </div>
    </div>
    
    <div class="package-grid">
        {{range $index, $package := .Category.Packages}}
        <div class="package-card {{if $package.Badge}}best-deal{{end}}"
             onclick="selectPackage(this, '{{$.Category.ID}}', {{$index}})">
            
            <div class="package-header">
                <div class="package-klipp">{{$package.Klipp}}</div>
                <div class="package-price">
                    <div class="total-price">{{$.Community.FormatPrice $package.Price}}</div>
                    <div class="per-klipp">{{$.Community.FormatPrice $package.PricePerKlipp}}/klipp</div>
                </div>
            </div>
            
            {{if gt $package.SavePercent 0}}
            <div class="savings">SAVE {{$package.SavePercent}}%</div>
            {{end}}
            
            <button class="purchase-btn"
                    hx-post="/api/klippekort/purchase"
                    hx-vals='{"category_id": "{{$.Category.ID}}", "package_index": {{$index}}}'
                    hx-target="#purchase-result"
                    hx-swap="innerHTML"
                    hx-indicator=".htmx-indicator">
                BUY NOW
            </button>
        </div>
        {{end}}
    </div>
    
    {{if .Category.InfoText}}
    <div class="mt-3 p-3" style="background: #111; border: 1px solid #333; border-radius: 4px;">
        <small class="text-muted">
            <i class="bi bi-info-circle me-1"></i>
            {{.Category.InfoText}}
        </small>
    </div>
    {{end}}
</div>

<script>
function selectPackage(card, categoryId, packageIndex) {
    // Visual feedback
    document.querySelectorAll('.package-card').forEach(c => c.classList.remove('selected'));
    card.classList.add('selected');
}
</script>

<style>
.package-card.selected {
    border-color: #ff6b35 !important;
    box-shadow: 0 0 20px rgba(255,107,53,0.3) !important;
}
</style>
{{end}}